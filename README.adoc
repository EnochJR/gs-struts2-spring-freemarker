=== 基于struts+spring+ibatis+freemarker脚手架

如何在老系统支持mvc

[source]
<filter>
    <filter-username>struts2</filter-username>
    <filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>
   <!-- <filter-class>com.tom.filter.MyFilterDispatcher</filter-class>-->
</filter>
<filter-mapping>
    <filter-username>struts2</filter-username>
    <url-pattern>*.action</url-pattern>
    <dispatcher>REQUEST</dispatcher>
    <dispatcher>FORWARD</dispatcher>
    <dispatcher>INCLUDE</dispatcher>
</filter-mapping>

如何在老系统支持spring mvc,访问路径为/services/*
[source]
    <servlet>
        <servlet-username>springMvc</servlet-username>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-username>contextConfigLocation</param-username>
            <param-value>classpath:/com.tom.web.config/springmvc-servlet.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>
    <servlet-mapping>
        <servlet-username>springMvc</servlet-username>
        <url-pattern>/services/*</url-pattern>
    </servlet-mapping>
    
image::https://raw.githubusercontent.com/tomlxq/gs-struts2-spring-freemarker/master/src/doc/struts.png[Struts2官方站点提供的Struts 2 的整体结构,500,link="https://raw.githubusercontent.com/tomlxq/gs-struts2-spring-freemarker/master/src/doc/struts.png"]

### 一个请求在Struts2框架中的处理大概分为以下几个步骤：

* 客户端初始化一个指向Servlet容器（例如Tomcat）的请求；
* 这个请求经过一系列的过滤器（Filter）（这些过滤器中有一个叫做ActionContextCleanUp的可选过滤器，这个过滤器对于Struts2和其他框架的集成很有帮助，例如：SiteMesh Plugin）；
* 接着FilterDispatcher被调用，FilterDispatcher询问ActionMapper来决定这个请求是否需要调用某个Action；
* 如果ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给ActionProxy；
ActionProxy通过Configuration Manager（struts.xml）询问框架的配置文件，找到需要调用的Action类.
#### 如上文的struts.xml配置

[source]
<?xml version="1.0" encoding="GBK"?>
 <!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN" "http://struts.apache.org/dtds/struts-2.0.dtd">
 <struts>
     <include file="struts-default.xml"/>
     <package name="struts2" extends="struts-default">
         <action name="add" 
             class="demo.AddAction" >
             <result>add.jsp</result>
         </action>   
     </package>
 </struts>
 
* ActionProxy通过Configuration Manager询问框架的配置文件，找到需要调用的Action类；
* ActionProxy创建一个ActionInvocation的实例。
* ActionInvocation实例使用命名模式来调用，在调用Action的过程前后，涉及到相关拦截器（Intercepter）的调用。
* 一旦Action执行完毕，ActionInvocation负责根据struts.xml中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个Action链）一个需要被表示的JSP或者FreeMarker的模版。在表示的过程中可以使用Struts2框架中继承的标签。在这个过程中需要涉及到ActionMapper。

#### web.xml（截取）
[source]
<filter>
  <filter-name>struts2</filter-name>
  <filter-class>
       org.apache.struts2.dispatcher.FilterDispatcher
  </filter-class>
</filter>
<filter-mapping>
  <filter-name>struts2</filter-name>
  <url-pattern>/*</url-pattern>
</filter-mapping>